<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hello Rails | 噔噔！金色传说 的博客</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/blog/avatar.png">
    <meta name="description" content="Just playing around">
    <link rel="preload" href="/blog/assets/css/0.styles.b3ad8e09.css" as="style"><link rel="preload" href="/blog/assets/js/app.47ee474b.js" as="script"><link rel="preload" href="/blog/assets/js/2.c49ced60.js" as="script"><link rel="preload" href="/blog/assets/js/17.801af916.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.49699933.js"><link rel="prefetch" href="/blog/assets/js/11.941cadf2.js"><link rel="prefetch" href="/blog/assets/js/12.6dcd319d.js"><link rel="prefetch" href="/blog/assets/js/13.2c1095ef.js"><link rel="prefetch" href="/blog/assets/js/14.d4b8a302.js"><link rel="prefetch" href="/blog/assets/js/15.74c41f3b.js"><link rel="prefetch" href="/blog/assets/js/16.721ff162.js"><link rel="prefetch" href="/blog/assets/js/18.7eb5e596.js"><link rel="prefetch" href="/blog/assets/js/19.eeb03979.js"><link rel="prefetch" href="/blog/assets/js/3.a23768da.js"><link rel="prefetch" href="/blog/assets/js/4.685e2bcc.js"><link rel="prefetch" href="/blog/assets/js/5.24d4aeaf.js"><link rel="prefetch" href="/blog/assets/js/6.da0c2ac9.js"><link rel="prefetch" href="/blog/assets/js/7.44875e16.js"><link rel="prefetch" href="/blog/assets/js/8.64aaccae.js"><link rel="prefetch" href="/blog/assets/js/9.aceebfb9.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.b3ad8e09.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/avatar.png" alt="噔噔！金色传说 的博客" class="logo"> <span class="site-name can-hide">噔噔！金色传说 的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/react/hooks.html" class="nav-link">
  博客
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/react/hooks.html" class="nav-link">
  博客
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/javascript/" class="sidebar-link">JavaScript</a></li><li><a href="/blog/javascript/new.html" class="sidebar-link">new</a></li><li><a href="/blog/javascript/curring.html" class="sidebar-link">柯里化</a></li><li><a href="/blog/javascript/higher-order.html" class="sidebar-link">call bind apply理解</a></li><li><a href="/blog/javascript/bind.html" class="sidebar-link">手写bind</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/vue/vuex-modules.html" class="sidebar-link">Vuex 模块化实践</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/react/hooks.html" class="sidebar-link">React Hooks 理解</a></li><li><a href="/blog/react/redux.html" class="sidebar-link">Redux, React-Redux</a></li><li><a href="/blog/react/rx-hooks.html" class="sidebar-link">Rxjs, Rx-hooks</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/chrome/" class="sidebar-link">页面渲染机制（DOM和CSSOM树）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ruby</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/ruby/hello_rails.html" class="active sidebar-link">Hello Rails</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/ruby/hello_rails.html#创建项目" class="sidebar-link">创建项目</a></li><li class="sidebar-sub-header"><a href="/blog/ruby/hello_rails.html#hello-rails-2" class="sidebar-link">Hello rails</a></li></ul></li><li><a href="/blog/ruby/morney_rails.html" class="sidebar-link">Rails 实践</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/other/markdown.html" class="sidebar-link">MarkDown 基本语法</a></li><li><a href="/blog/engineering/" class="sidebar-link">从React UI组件库项目研究前端工程化思路</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="hello-rails"><a href="#hello-rails" class="header-anchor">#</a> Hello Rails</h1> <h2 id="创建项目"><a href="#创建项目" class="header-anchor">#</a> 创建项目</h2> <p><code>rails new morney-rails-1 --database=postgresql --skip-action-mailbox --skip-action-text --skip-sprockets --skip-javascript --skip-turbolinks --skip-system-test --skip-test --api --skip-webpack-install</code><br>
解释一下：
<code>--database=postgresql</code>  数据库指定为 postgresql<br> <code>--skip-action-mailbox</code>  跳过收件箱<br> <code>--skip-action-text</code>  跳过富文本 默认的富文本用不到<br> <code>--skip-sprockets</code>  跳过，不清楚用来干啥<br> <code>--skip-javascript</code>  跳过js，前后端代码分离，rails不负责js<br> <code>--skip-turbolinks</code>  跳过，不清楚用来干啥<br> <code>--skip-system-test</code> 跳过系统测试<br> <code>--skip-test</code>  跳过测试 我们会自己添加测试，不用系统默认的测试<br> <code>--api</code>   使用api模式 一个轻量的模式<br> <code>--skip-webpack-install</code>  跳过webpack安装，前后分离后端不用负责这些</p> <h2 id="hello-rails-2"><a href="#hello-rails-2" class="header-anchor">#</a> Hello rails</h2> <p>创建完成后就可以打开这个项目，这里用的rubymine
找到 <code>routes.rb</code> 文件
这个文件用来添加路由：</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># do ... end 就是函数</span>
<span class="token constant">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>routes<span class="token punctuation">.</span>draw <span class="token keyword">do</span>  
    get <span class="token string">'/hello'</span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token string">'first#hello'</span>  <span class="token comment"># get('/hello', {to: 'first#hello'}) 的缩写  </span>
    <span class="token comment"># 'first#hello' 代表 在 first 这个 controller 上 的 hello 方法 （controller 是 MVC 的 C）</span>
<span class="token keyword">end</span>
</code></pre></div><p>于是我们就去 app/controllers 文件夹下添加 <code>first_controller.rb</code></p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment"># 这个Controller 必须叫 FirstController 这是约定！ 并且继承自 ApplicationController。</span>
<span class="token comment"># ApplicationController 这个 Controller 是个基础的 controller</span>
<span class="token keyword">class</span> <span class="token class-name">FirstController</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationController</span>  
<span class="token comment"># 对应路由里的 first#hello  </span>
    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">hello</span></span>    
        <span class="token comment"># render plain: 'hello'  # 返回一个 hello 字符串  </span>
        render json<span class="token punctuation">:</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'kin'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span> <span class="token comment"># 返回一个json</span>
        <span class="token comment"># render 'first/hello'  # 返回一个html 'first/hello'是html模板的路径</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><p>然后就可以尝试运行了！  命令： <code>rails server</code></p> <h3 id="数据库启动-及安装"><a href="#数据库启动-及安装" class="header-anchor">#</a> 数据库启动 及安装</h3> <p>但是运行还是会出现问题，因为rails会默认使用数据库，但是我们并没有启动一个数据库服务<br>
所以这里需要用 docker 来启动一个数据库服务
命令：
<code>docker run -v morney-rails-1-data:/var/lib/postgresql/data -p 5001:5432 -e POSTGRES_USER=fang -e POSTGRES_PASSWORD=123456 -d postgres:12.1</code>
解释：
<code>-v morney-rails-1-data:/var/lib/postgresql/data</code> 冒号前面的部分是本地数据库路径，但是windows用户只支持使用文件名，不支持绝对路径，所以只能这样写。冒号后面的部分就是虚拟机内部的路径<br> <code>-p 5001:5432</code> 左边是实体端口，右边是虚拟机里的端口<br> <code>-e POSTGRES_USER=kin -e POSTGRES_PASSWORD=123456</code>  -e 是环境变量，用于配置数据库账号密码<br> <code>-d</code> 代表deamon模式，守护进程模式，也就是一直开着<br> <code>postgres:12.2</code>  安装的镜像版本
<strong>这个命令很慢，配了国内镜像还是好慢，好像配置没有效果</strong> <strong>最后尝试 在profixer里加入vbox的规则，成功代理，速度快了不少</strong></p> <h3 id="数据库启动后-rails连接数据库"><a href="#数据库启动后-rails连接数据库" class="header-anchor">#</a> 数据库启动后 rails连接数据库</h3> <p><code>项目/config/database.yml</code> 文件配置数据库连接信息
贴代码：</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">default</span><span class="token punctuation">:</span> <span class="token important">&amp;default</span>
  adapter<span class="token punctuation">:</span> postgresql
  encoding<span class="token punctuation">:</span> unicode
  pool<span class="token punctuation">:</span> &lt;%= ENV.fetch(&quot;RAILS_MAX_THREADS&quot;) <span class="token punctuation">{</span> 5 <span class="token punctuation">}</span> %<span class="token punctuation">&gt;</span>  <span class="token comment"># 线程池数量</span>
  username<span class="token punctuation">:</span> fang
  password<span class="token punctuation">:</span> <span class="token number">123456</span>
  host<span class="token punctuation">:</span> 192.168.99.100  <span class="token comment"># 默认为 localhost，但是docker toolbox用户需要填入对应ip</span>
  port<span class="token punctuation">:</span> <span class="token number">5001</span>
<span class="token key atrule">development</span><span class="token punctuation">:</span>
  &lt;&lt;<span class="token punctuation">:</span> <span class="token important">*default</span>  <span class="token comment"># 开发环境继承 default</span>
  database<span class="token punctuation">:</span> morney_rails_1_development
<span class="token key atrule">test</span><span class="token punctuation">:</span>
  &lt;&lt;<span class="token punctuation">:</span> <span class="token important">*default</span>
  database<span class="token punctuation">:</span> morney_rails_1_test
<span class="token key atrule">production</span><span class="token punctuation">:</span>
  &lt;&lt;<span class="token punctuation">:</span> <span class="token important">*default</span>
  database<span class="token punctuation">:</span> morney_rails_1_production
  username<span class="token punctuation">:</span> morney_rails_1
  password<span class="token punctuation">:</span> &lt;%= ENV<span class="token punctuation">[</span><span class="token string">'MORNEY_RAILS_1_DATABASE_PASSWORD'</span><span class="token punctuation">]</span> %<span class="token punctuation">&gt;</span>  <span class="token comment"># 千万不要把真实密码放在这里，使用环境变量就不会导致密码泄露</span>
</code></pre></div><h3 id="创建数据库"><a href="#创建数据库" class="header-anchor">#</a> 创建数据库</h3> <p>数据库软件启动后，数据库还是需要创建的，否则还是会报错
<code>rails db:create</code>  只需要输入这个命令就可以让rails根据配置自动创建数据库</p> <blockquote><p><em>执行结果</em><br>
Created database 'morney_rails_1_development'<br>
Created database 'morney_rails_1_test'<br>
测试环境和开发环境的数据库会自动创建好，生产环境的话还是需要自己去创建的</p></blockquote> <p>然后你的 Hello Rails 服务就可以跑起来了。<br>
重新运行 <code>rails s</code> # rails server 的缩写</p> <blockquote><p><strong>补充命令</strong><br> <code>rails db:drop</code> 删除数据库</p></blockquote> <h3 id="windows-用户配置热更新"><a href="#windows-用户配置热更新" class="header-anchor">#</a> windows 用户配置热更新</h3> <p>文件更新后需要重启 server才会变化，这就很蛋疼了。需要加一个配置：
<code>config/environments/development.rb</code>文件最下面<br>
取消注释：<code>config.file_watcher = ActiveSupport::EventedFileUpdateChecker</code> <code>Gemfile</code>文件<br>
修改 <code>group :development</code></p> <div class="language-ruby extra-class"><pre class="language-ruby"><code>group <span class="token symbol">:development</span> <span class="token keyword">do</span>
  gem <span class="token string">'listen'</span>
  gem <span class="token string">'wdm'</span><span class="token punctuation">,</span> <span class="token string">'&gt;= 0.1.0'</span><span class="token punctuation">,</span> platforms<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token symbol">:mswin</span><span class="token punctuation">,</span> <span class="token symbol">:mingw</span><span class="token punctuation">,</span> <span class="token symbol">:x64_mingw</span><span class="token punctuation">,</span> <span class="token symbol">:jruby</span><span class="token punctuation">]</span> <span class="token comment"># wdm全称 windows directory monitor</span>
<span class="token keyword">end</span>
</code></pre></div><h3 id="docker-相关命令补充"><a href="#docker-相关命令补充" class="header-anchor">#</a> docker 相关命令补充</h3> <p><code>docker-machine create default --virtualbox-no-vtx-check</code> 不检查hype-v创建虚default虚拟机<br> <code>docker-machine ssh default</code>  ssh到虚拟机 default<br> <code>docker-machine rm default</code>  删除虚拟机 default<br>
在虚拟机中<code>exit</code> 可以退回docker命令行</p> <p><code>sudo sed -i &quot;s|EXTRA_ARGS='|EXTRA_ARGS='--registry-mirror=https://docker.mirrors.ustc.edu.cn |g&quot; /var/lib/boot2docker/profile</code>  toolbox配置国内镜像,其他操作系统可以看这个 <a href="http://guide.daocloud.io/dcs/daocloud-9153151.html" target="_blank" rel="noopener noreferrer">加速指南<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><code>docker ps -a</code> 查看运行的容器<br> <code>docker kill xxxx</code> 关闭id为xxxx的容器（关机）<br> <code>docker restart xxxx</code> 重启关闭的容器<br> <code>docker rm xxxx</code> 删除容器，删除后重新创建容器就需要运行前面的 docker run命令<br> <code>docker container prune</code> 删除无用容器，节省空间<br> <code>docker image prune</code>  删除无用镜像，节省空间</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/chrome/" class="prev">
        页面渲染机制（DOM和CSSOM树）
      </a></span> <span class="next"><a href="/blog/ruby/morney_rails.html">
        Rails 实践
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.47ee474b.js" defer></script><script src="/blog/assets/js/2.c49ced60.js" defer></script><script src="/blog/assets/js/17.801af916.js" defer></script>
  </body>
</html>

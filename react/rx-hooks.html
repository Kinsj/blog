<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Rxjs, Rx-hooks | å™”å™”ï¼é‡‘è‰²ä¼ è¯´ çš„åšå®¢</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/blog/avatar.png">
    <meta name="description" content="Just playing around">
    <link rel="preload" href="/blog/assets/css/0.styles.b3ad8e09.css" as="style"><link rel="preload" href="/blog/assets/js/app.a045580b.js" as="script"><link rel="preload" href="/blog/assets/js/2.c49ced60.js" as="script"><link rel="preload" href="/blog/assets/js/16.c03fc1da.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.73252189.js"><link rel="prefetch" href="/blog/assets/js/11.3e415718.js"><link rel="prefetch" href="/blog/assets/js/12.fd09ba99.js"><link rel="prefetch" href="/blog/assets/js/13.354c95fa.js"><link rel="prefetch" href="/blog/assets/js/14.065eb75e.js"><link rel="prefetch" href="/blog/assets/js/15.cefe3092.js"><link rel="prefetch" href="/blog/assets/js/17.9b0f6161.js"><link rel="prefetch" href="/blog/assets/js/3.54356929.js"><link rel="prefetch" href="/blog/assets/js/4.685e2bcc.js"><link rel="prefetch" href="/blog/assets/js/5.24d4aeaf.js"><link rel="prefetch" href="/blog/assets/js/6.da0c2ac9.js"><link rel="prefetch" href="/blog/assets/js/7.1a2a4599.js"><link rel="prefetch" href="/blog/assets/js/8.64aaccae.js"><link rel="prefetch" href="/blog/assets/js/9.a8c62c8a.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.b3ad8e09.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/avatar.png" alt="å™”å™”ï¼é‡‘è‰²ä¼ è¯´ çš„åšå®¢" class="logo"> <span class="site-name can-hide">å™”å™”ï¼é‡‘è‰²ä¼ è¯´ çš„åšå®¢</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/blog/react/hooks.html" class="nav-link">
  åšå®¢
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/blog/react/hooks.html" class="nav-link">
  åšå®¢
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/javascript/" class="sidebar-link">JavaScript</a></li><li><a href="/blog/javascript/new.html" class="sidebar-link">new</a></li><li><a href="/blog/javascript/curring.html" class="sidebar-link">æŸ¯é‡ŒåŒ–</a></li><li><a href="/blog/javascript/higher-order.html" class="sidebar-link">call bind applyç†è§£</a></li><li><a href="/blog/javascript/bind.html" class="sidebar-link">æ‰‹å†™bind</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/vue/vuex-modules.html" class="sidebar-link">Vuex æ¨¡å—åŒ–å®è·µ</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/react/hooks.html" class="sidebar-link">React Hooks ç†è§£</a></li><li><a href="/blog/react/redux.html" class="sidebar-link">Redux, React-Redux</a></li><li><a href="/blog/react/rx-hooks.html" class="active sidebar-link">Rxjs, Rx-hooks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/react/rx-hooks.html#é‡åˆ°é—®é¢˜" class="sidebar-link">é‡åˆ°é—®é¢˜</a></li><li class="sidebar-sub-header"><a href="/blog/react/rx-hooks.html#åˆ†æéœ€æ±‚ï¼Œå»ºæ¨¡é—®é¢˜" class="sidebar-link">åˆ†æéœ€æ±‚ï¼Œå»ºæ¨¡é—®é¢˜</a></li><li class="sidebar-sub-header"><a href="/blog/react/rx-hooks.html#é€ä¸ªå®ç°" class="sidebar-link">é€ä¸ªå®ç°</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>æµè§ˆå™¨</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/chrome/" class="sidebar-link">é¡µé¢æ¸²æŸ“æœºåˆ¶ï¼ˆDOMå’ŒCSSOMæ ‘ï¼‰</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>å·¥ç¨‹åŒ–</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/engineering/" class="sidebar-link">ä»React UIç»„ä»¶åº“é¡¹ç›®ç ”ç©¶å‰ç«¯å·¥ç¨‹åŒ–æ€è·¯</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>å…¶ä»–</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/other/markdown.html" class="sidebar-link">MarkDown åŸºæœ¬è¯­æ³•</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="rxjs-rx-hooks"><a href="#rxjs-rx-hooks" class="header-anchor">#</a> Rxjs, Rx-hooks</h1> <h2 id="é‡åˆ°é—®é¢˜"><a href="#é‡åˆ°é—®é¢˜" class="header-anchor">#</a> é‡åˆ°é—®é¢˜</h2> <p>è¿™æ¬¡åœ¨å¼€å‘å…¬å¸çš„é¡¹ç›®æ—¶é‡åˆ°äº†è¯·æ±‚æ•°æ®æ—¶çš„ç«æ€é—®é¢˜ï¼š
é¡¹ç›®åŸå‹å¦‚ä¸‹å›¾ï¼š
<img src="/blog/react/yun.png" width="300" alt="é¡¹ç›®åŸå‹"></p> <p>å½“çŸ­æ—¶é—´æ‰§è¡Œå¤šä¸ªåŠ è½½åŠ¨ä½œæ—¶å°±ä¼šå‡ºç°ç«æ€é—®é¢˜ï¼Œéå¸¸å¤´ç–¼ï¼ï¼ˆåˆ°åº•åŠ è½½æ›´å¤šï¼Œç­›é€‰è¯·æ±‚å¯¹åº”æ•°æ®ç­‰æ“ä½œï¼‰</p> <p>é‚£ä¹ˆè§£å†³ç«æ€é—®é¢˜æœ€å¼ºå¤§çš„è‡ªç„¶æ˜¯å“åº”å¼ç¼–ç¨‹æ€æƒ³çš„Rxjså•¦ï¼
å’Œreactç»“åˆä½¿ç”¨çš„è¯è‡ªç„¶æ˜¯å¼•å…¥ rx-hooks</p> <p>rx-hooks å…¥é—¨:
<a href="https://zhuanlan.zhihu.com/p/50921147" title="åƒå‘¼å¸ä¸€æ ·è‡ªç„¶ï¼šReact hooks + RxJS" target="_blank" rel="noopener noreferrer">åƒå‘¼å¸ä¸€æ ·è‡ªç„¶ï¼šReact hooks + RxJS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="åˆ†æéœ€æ±‚ï¼Œå»ºæ¨¡é—®é¢˜"><a href="#åˆ†æéœ€æ±‚ï¼Œå»ºæ¨¡é—®é¢˜" class="header-anchor">#</a> åˆ†æéœ€æ±‚ï¼Œå»ºæ¨¡é—®é¢˜</h2> <p>éœ€æ±‚ï¼š</p> <ol><li>å¤šæ¬¡ç­›é€‰æ—¶ï¼Œåªä¿ç•™æœ€åä¸€æ¬¡ç­›é€‰ï¼Œå–æ¶ˆå‰é¢æ²¡æœ‰è¿”å›ç»“æœçš„ç­›é€‰</li> <li>åˆ°åº•åŠ è½½æ—¶ï¼Œå¦‚æœæœ‰å¤šæ¬¡è§¦å‘åˆ°åº•åŠ è½½ï¼Œåœ¨ä¸Šæ¬¡åŠ è½½è¿˜æ²¡ç»“æŸå‰ä¸å“åº”åé¢çš„åˆ°åº•äº‹ä»¶</li> <li>åˆ°åº•åŠ è½½æ—¶å‡ºç°ç­›é€‰äº‹ä»¶ï¼Œç›´æ¥å–æ¶ˆåˆ°åº•åŠ è½½äº‹ä»¶</li></ol> <p>æŠ½è±¡ä¸€ä¸‹ï¼š</p> <ul><li>æŠŠä¸¤æ¬¡ä¸ªäº‹ä»¶éƒ½æŠ½è±¡æˆ<strong>åŠ è½½äº‹ä»¶</strong>ï¼Œç”¨è§¦å‘æ—¶çš„æ ‡å¿—åŒºåˆ†äº‹ä»¶ç±»å‹ï¼Œè¿‡æ»¤å‡ºä¸¤æ¡äº‹ä»¶æµï¼ˆ<strong>ç­›é€‰äº‹ä»¶æµï¼Œåˆ°åº•åŠ è½½äº‹ä»¶æµ</strong>ï¼‰ã€‚æœ€åsubscribe è¿™ä¸¤æ¡äº‹ä»¶æµ</li> <li>åœ¨è¿™ä¸¤ä¸ªäº‹ä»¶æµä¸Šå¯ä»¥å„è‡ªå®ç° <strong>éœ€æ±‚1</strong> å’Œ <strong>éœ€æ±‚2</strong></li> <li>è¿™æ ·åœ¨ç­›é€‰äº‹ä»¶æµå‘å‡ºæ–°å€¼æ—¶é˜»æ–­åˆ°åº•åŠ è½½äº‹ä»¶æµä¸Šæ­£åœ¨æ‰§è¡Œçš„æ“ä½œå°±å¯ä»¥å®ç°<strong>éœ€æ±‚3</strong></li></ul> <h2 id="é€ä¸ªå®ç°"><a href="#é€ä¸ªå®ç°" class="header-anchor">#</a> é€ä¸ªå®ç°</h2> <p>è¦å®ç°ä¸¤ç§äº‹ä»¶å‘å°„åˆ°åŒä¸€ä¸ªäº‹ä»¶æµï¼ˆ<strong>åŠ è½½äº‹ä»¶æµ</strong>ï¼‰å°±è¦ä½¿ç”¨useEventCallback()</p> <h3 id="useeventcallback"><a href="#useeventcallback" class="header-anchor">#</a> useEventCallback</h3> <p>åˆ›å»ºäº‹ä»¶æµå›è°ƒï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆå½¢å®¹useEventCallbackï¼‰
å‚è€ƒæˆ‘å†™çš„demoï¼š<a href="https://zhuanlan.zhihu.com/p/50921147" target="_blank" rel="noopener noreferrer">https://codesandbox.io/s/rxjs-hooks-drag-list-6opp3?file=/src/index.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>useEventCallback<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs-hooks'</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>loadEventCallback<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useEventCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">return</span> xxx$<span class="token comment">//äº‹ä»¶æµ</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="åœ¨ç»„ä»¶ä¸­ä½¿ç”¨"><a href="#åœ¨ç»„ä»¶ä¸­ä½¿ç”¨" class="header-anchor">#</a> åœ¨ç»„ä»¶ä¸­ä½¿ç”¨</h3> <p>åˆšåˆšç”¨ <code>useEventCallback</code> åˆ›å»ºäº† <code>loadEventCallback</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">JobPad</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">,</span> loadEventCallback<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useJobList</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>place<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">scrollHandle</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>scrollTop<span class="token punctuation">,</span> clientHeight<span class="token punctuation">,</span> scrollHeight<span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>scrollHeight <span class="token operator">-</span> <span class="token punctuation">(</span>scrollTop <span class="token operator">+</span> clientHeight<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// console.log('åˆ°è¾¾åº•éƒ¨');</span>
      <span class="token function">loadEventCallback</span><span class="token punctuation">(</span><span class="token string">'loadMore'</span><span class="token punctuation">)</span> <span class="token comment">// ğŸ’¡</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">...</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">classes</span><span class="token punctuation">(</span><span class="token string">'selector-wrapper'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Selector <span class="token operator">...</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>loadEventCallback<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token operator">...</span> onScroll<span class="token operator">=</span><span class="token punctuation">{</span>scrollHandle<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">...</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Selector</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token operator">&lt;</span>Option onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span><span class="token string">'selectorChanged'</span><span class="token punctuation">)</span> <span class="token comment">/*ğŸ’¡*/</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="è¿‡æ»¤å‡ºä¸¤ä¸ªåŠ è½½äº‹ä»¶æµ-ï¼ˆåˆ°åº•åŠ è½½ï¼Œç­›é€‰åŠ è½½ï¼‰"><a href="#è¿‡æ»¤å‡ºä¸¤ä¸ªåŠ è½½äº‹ä»¶æµ-ï¼ˆåˆ°åº•åŠ è½½ï¼Œç­›é€‰åŠ è½½ï¼‰" class="header-anchor">#</a> è¿‡æ»¤å‡ºä¸¤ä¸ªåŠ è½½äº‹ä»¶æµ ï¼ˆåˆ°åº•åŠ è½½ï¼Œç­›é€‰åŠ è½½ï¼‰</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>loadEventCallback<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useEventCallback</span><span class="token punctuation">(</span>
    <span class="token parameter">event$</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

      <span class="token comment">// 1.ç­›é€‰å‡ºä¸¤ä¸ªåŠ è½½äº‹ä»¶æµ ï¼ˆåˆ°åº•åŠ è½½ï¼Œç­›é€‰åŠ è½½ï¼‰</span>
      <span class="token keyword">const</span> selectorChange$ <span class="token operator">=</span> event$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=&gt;</span> type <span class="token operator">===</span> <span class="token string">'selectorChanged'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> reachEnd$ <span class="token operator">=</span> event$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=&gt;</span> type <span class="token operator">===</span> <span class="token string">'loadMore'</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="å®šä¹‰ä¸¤ä¸ªæµçš„åŸºæœ¬è¡Œä¸º"><a href="#å®šä¹‰ä¸¤ä¸ªæµçš„åŸºæœ¬è¡Œä¸º" class="header-anchor">#</a> å®šä¹‰ä¸¤ä¸ªæµçš„åŸºæœ¬è¡Œä¸º</h3> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> reSearch$ <span class="token operator">=</span> selectorChange$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      <span class="token function">rxGetJsonApi</span><span class="token punctuation">(</span><span class="token string">'/getjob?'</span> <span class="token operator">+</span> <span class="token function">getJobFormData</span><span class="token punctuation">(</span>place<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">retry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">takeUntil</span><span class="token punctuation">(</span>event$<span class="token punctuation">)</span> <span class="token comment">// è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œäº‹ä»¶æµé‡Œå‡ºç°é€‰é¡¹å˜åŒ–äº‹ä»¶åˆ™ abort</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">concatAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// åºåˆ—åŒ–é¡ºåºï¼Œè§£å†³ç«æ€</span>
    <span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>list<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'ResetJobOfPage'</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> <span class="token punctuation">{</span>place<span class="token punctuation">,</span> list<span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>list<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">setIsNoMore</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> loadMore$ <span class="token operator">=</span> reachEnd$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token comment">// è§¦å‘ä¸€æ¬¡å ç›´åˆ°è¿”å›ç»“æœæ‰è§¦å‘ç¬¬äºŒæ¬¡</span>
    <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      <span class="token function">rxGetJsonApi</span><span class="token punctuation">(</span><span class="token string">'/getjob?'</span> <span class="token operator">+</span> <span class="token function">getJobFormData</span><span class="token punctuation">(</span>place<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">retry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>list<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'PushJobOfPage'</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> <span class="token punctuation">{</span>place<span class="token punctuation">,</span> list<span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>list<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">setIsNoMore</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="å®ç°éœ€æ±‚3"><a href="#å®ç°éœ€æ±‚3" class="header-anchor">#</a> å®ç°<em>éœ€æ±‚3</em></h3> <p>åˆ°åº•åŠ è½½æ—¶å‡ºç°ç­›é€‰äº‹ä»¶ï¼Œç›´æ¥å–æ¶ˆåˆ°åº•åŠ è½½äº‹ä»¶
è¿™ä¸ªéœ€æ±‚å®é™…ä¸Šåªéœ€è¦åœ¨loadMore$æµçš„è¯·æ±‚ä¸­åŠ ä¸€å¥ <code>takeUntil(selectorChange$)</code></p> <h3 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="header-anchor">#</a> å®Œæ•´ä»£ç </h3> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> <span class="token punctuation">[</span>loadEventCallback<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useEventCallback</span><span class="token punctuation">(</span>
    <span class="token parameter">event$</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

      <span class="token comment">// 1.ç­›é€‰å‡ºä¸¤ä¸ªåŠ è½½äº‹ä»¶æµ ï¼ˆåˆ°åº•åŠ è½½ï¼Œç­›é€‰åŠ è½½ï¼‰</span>
      <span class="token keyword">const</span> selectorChange$ <span class="token operator">=</span> event$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=&gt;</span> type <span class="token operator">===</span> <span class="token string">'selectorChanged'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// ç­›é€‰åŠ è½½æµå‘å°„äº‹ä»¶æ—¶è¦è®¾ç½® isNoMore ä¸º false</span>
        <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setIsNoMore</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// setState ä¸¤æ¬¡çš„å€¼ç›¸åŒä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> reachEnd$ <span class="token operator">=</span> event$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=&gt;</span> type <span class="token operator">===</span> <span class="token string">'loadMore'</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 2.å®šä¹‰ä¸¤ä¸ªæµçš„åŸºæœ¬è¡Œä¸º</span>
      <span class="token comment">// ç­›é€‰æµæ–°äº‹ä»¶é˜»æ–­æ—§äº‹ä»¶</span>
      <span class="token keyword">const</span> reSearch$ <span class="token operator">=</span> selectorChange$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
          <span class="token function">rxGetJsonApi</span><span class="token punctuation">(</span><span class="token string">'/getjob?'</span> <span class="token operator">+</span> <span class="token function">getJobFormData</span><span class="token punctuation">(</span>place<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
            <span class="token function">retry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">takeUntil</span><span class="token punctuation">(</span>event$<span class="token punctuation">)</span> <span class="token comment">// è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œäº‹ä»¶æµé‡Œå‡ºç°é€‰é¡¹å˜åŒ–äº‹ä»¶åˆ™ abort</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">concatAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// åºåˆ—åŒ–é¡ºåºï¼Œè§£å†³ç«æ€</span>
        <span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>list<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'ResetJobOfPage'</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> <span class="token punctuation">{</span>place<span class="token punctuation">,</span> list<span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>list<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">setIsNoMore</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> loadMore$ <span class="token operator">=</span> reachEnd$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token comment">// è§¦å‘ä¸€æ¬¡å ç›´åˆ°è¿”å›ç»“æœæ‰è§¦å‘ç¬¬äºŒæ¬¡</span>
        <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
          <span class="token function">rxGetJsonApi</span><span class="token punctuation">(</span><span class="token string">'/getjob?'</span> <span class="token operator">+</span> <span class="token function">getJobFormData</span><span class="token punctuation">(</span>place<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
            <span class="token function">retry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// ç­›é€‰æµæ–°äº‹ä»¶é˜»æ–­åˆ°åº•åŠ è½½æµ takeUntil</span>
            <span class="token function">takeUntil</span><span class="token punctuation">(</span>selectorChange$<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// ğŸ’¡</span>
            <span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>list<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'PushJobOfPage'</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> <span class="token punctuation">{</span>place<span class="token punctuation">,</span> list<span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>list<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">setIsNoMore</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// è¿”å›ä¸¤ä¸ªæµçš„ subscribe</span>
      <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span>reSearch$<span class="token punctuation">,</span> loadMore$<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>åˆ°è¿™é‡Œï¼Œéœ€æ±‚å°±å…¨éƒ¨å®ç°å•¦ï¼</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/blog/react/redux.html" class="prev">
        Redux, React-Redux
      </a></span> <span class="next"><a href="/blog/chrome/">
        é¡µé¢æ¸²æŸ“æœºåˆ¶ï¼ˆDOMå’ŒCSSOMæ ‘ï¼‰
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.a045580b.js" defer></script><script src="/blog/assets/js/2.c49ced60.js" defer></script><script src="/blog/assets/js/16.c03fc1da.js" defer></script>
  </body>
</html>
